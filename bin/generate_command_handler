#!/usr/bin/env bash

set -e

NAME=${NAME}
if [[ ${NAME} == '' ]]; then
    echo "Please set name. Call something like COMMAND_IDENTIFIER=command.identifier NAME=NewHandlerName bin/generate_command_handler"
    exit
fi
if [[ ${COMMAND_IDENTIFIER} == '' ]]; then
    echo "Please set name. Call something like COMMAND_IDENTIFIER=command.identifier NAME=NewHandlerName bin/generate_started_module"
    exit
fi
SOURCE_FILE=raspilot/commands/`echo ${NAME} | perl -ne 'print lc(join("_", split(/(?=[A-Z])/)))'`_command.py


if [[ -a ${SOURCE_FILE} ]]; then
  echo ${SOURCE_FILE} "already exists."
  exit;
fi

cat << EOF > ${SOURCE_FILE}
from new_raspilot.core.commands.command import BaseCommand, BaseCommandHandler


class ${NAME}Command(BaseCommand):
    NAME = '${COMMAND_IDENTIFIER}'

    def __init__(self):
        super().__init__(${NAME}Command.NAME)


class ${NAME}CommandHandler(BaseCommandHandler):
    def __init__(self):
        super().__init__()

    def run_action(self, command):
        if command is None:
            return None
EOF


