#!/usr/bin/env bash

BRANCH=master

set -e
if [[ ${RASPILOT_PATH} != '' ]]; then
    CURRENT_DIR=$(pwd)
    echo "Loading new version"
    cd ${RASPILOT_PATH}
    git fetch --all > /dev/null
    if [[ $(git log HEAD..origin/master --oneline) != '' ]]; then
        if [[ $(git rev-parse --abbrev-ref HEAD) != ${BRANCH} ]]; then
            git checkout ${BRANCH} > /dev/null
        fi
        git reset --hard origin/${BRANCH} > /dev/null
        python setup.py install
        echo 'Update complete'
    else
        echo 'Latest version installed'
    fi
    cd ${CURRENT_DIR}
else
    echo 'RASPILOT_PATH not set'
fi